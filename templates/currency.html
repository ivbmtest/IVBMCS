{% extends "main_layout.html" %}

    {% block content %}
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
        }

        .pagination-container {
            display: flex;
            justify-content: center;
            margin-top: 20px;
            border: 1px solid black;
        }
        .pagination {
            display: flex;
            list-style: none;
            padding: 0;
        }

        .pagination-button {
           
            cursor: pointer;
            border: 1px solid #ddd;
            padding: 8px 12px;
            background-color: #fff;
            color: #007bff;
            text-decoration: none;
            transition: background-color 0.3s ease;
        }

        .pagination-button:hover {
            background-color: #007bff;
            color: #fff;
        }

        .active-page {
            background-color: #007bff;
            color: #fff;
            border: 1px solid #007bff;
        }
    </style>
      <div class="home-content">
    <body >
      <div class="container" >
          <div class="table-wrapper">
              <div class="table-title">
                  <div class="row"> 
                      <div class="col-sm-2">
              <h3>Currency <b>Details</b></h3>
              
            </div>
            
              <form action="{% url 'ser' %}" method="post" style="width: 100%;" class="col-sm-4">
                {% csrf_token %}
              <div class="input-group ">
                <div class="form-outline " data-mdb-input-init>
                  <input name="ser_name" type="search" id="filter-input" class="form-control" placeholder="Search..." />
                 
                </div>
                <button type="submit" class="btn btn-primary" data-mdb-ripple-init>
                  <i class='bx bx-search-alt'></i>
                </button>
              </div>
            </form>
            
            <div class="col-sm-6">
              <a href="#addEmployeeModal" class="btn btn-success" data-toggle="modal"><i class='bx bx-plus'></i> <span>Add New Currency</span></a>
              <a href="#deleteEmployeeModal" class="btn btn-danger" id="getValues" data-toggle="modal"><i class='bx bxs-trash'></i> <span>Delete</span></a>						
            </div>
                  </div>
              </div>
             
              <div class="scrollmenu" style="overflow: auto;">
              
                <table id="table">
                  <thead>
                    <tr>
                      <th class="checkbox-col"><input type="checkbox" id="select-all"></th>
            {% for field in field_names %}
                        <th>{{field}}</th>
                        
                        {% comment %} <th>Symbol</th>
                        <th>Description</th>
                        <th>Status</th>
                        <th>Created By</th>
                        <th>Created On</th>
                        <th>Action</th> {% endcomment %}
                        {% endfor %}
                        <th>Action</th>
                    </tr>
                </thead>
                  <tbody id="table-body">
                      <!-- Data will be loaded dynamically here -->
                  </tbody>
              </table>
              


            </div>
            <div id="pagination-container">
              <!-- Pagination buttons will be appended here -->
          </div>
       
          </div>
      </div>  
    <!-- Edit Modal HTML -->
    <div id="addEmployeeModal" class="modal fade ">
      <div class="modal-dialog" id="m">
        <div class="modal-content">
          <form id="myForm" method="post" action="{% url 'currency' %}">
            {% csrf_token %}
            <div class="modal-header">						
              <h4 class="modal-title">Add Employee</h4>
              <p class="text-danger" id="msg_cur"></p>
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            </div>
            <div class="modal-body">
              <form method="post" action="{% url 'currency' %}">
              {% csrf_token %}
              {{ form.as_p }}	
            </div>
            <div class="modal-footer">
              <input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
              <input type="submit" class="btn btn-success" value="Add" >
            </div>
          </form>
        </div>
      </div>
    </div>
    <!-- Edit Modal HTML -->
    <div id="editEmployeeModal" class="modal fade">
      <div class="modal-dialog">
        <div class="modal-content">
          <form >
           
            <div class="modal-header">						
              <h4 class="modal-title">Edit Employee</h4>
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            </div>
            {% csrf_token %}
            {{ form.as_p }}
            {% comment %} <div class="modal-body">					
              <div class="form-group">
                <label>Name</label>
                <input type="text" class="form-control" required>
              </div>
              <div class="form-group">
                <label>Email</label>
                <input type="email" class="form-control" required>
              </div>
              <div class="form-group">
                <label>Address</label>
                <textarea class="form-control" required></textarea>
              </div>
              <div class="form-group">
                <label>Phone</label>
                <input type="text" class="form-control" required>
              </div>					
            </div> {% endcomment %}
            <div class="modal-footer">
              <input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
              <input type="submit" class="btn btn-info" value="Save" >
            </div>
          </form>
        </div>
      </div>
    </div>
    <!-- Delete Modal HTML -->
    <div id="deleteEmployeeModal" class="modal fade">
      <div class="modal-dialog">
        <div class="modal-content">
          <form action="{% url 'select_del' %}">
            <div class="modal-header">						
              <h4 class="modal-title">Delete Employee</h4>
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            </div>
            <div class="modal-body">					
              <p>Are you sure you want to delete these Records? </p>
              
              <p class="text-warning"><small>This action cannot be undone.</small></p>
            </div>
            <div class="modal-footer">
              <input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
             <input type="hidden" value="" id="select_id" name="select">
              <input type="submit" class="btn btn-danger" value="Delete">
            </div>
          </form>
        </div>
      </div>
    </div>

    <!--pagination-->
<script>
  function showPage(pageNumber) {
      // Hide all pages
      $('.page').removeClass('active-page');
  
      // Show the selected page
      $('#page' + pageNumber).addClass('active-page');
  }
  
  function fetchPage(pageNumber) {
      var search = $('#filter-input').val();
      $.ajax({
          type: 'GET',
          url: '/paginated_and_filtered_data/?page=' + pageNumber + '&search=' + search,
          success: function(response) {
              updateTable(response.data);
              showPage(pageNumber);
              createPaginationButtons(response.total_pages, pageNumber);
          },
          error: function(error) {
              console.error('Error fetching data:', error);
          }
      });
      $('#select-all').prop('checked', false);
}
  function updateTable(data) {
      var tableBody = $('#table-body');
      tableBody.empty();
  
      for (var i = 0; i < data.length; i++) {
          tableBody.append('<tr><td class="checkbox-col"><input type="checkbox" class="row-checkbox" value='+ data[i].crid +'></td><td>' + data[i].crid + '</td><td>' + data[i].name + '</td><td>' + data[i].symbol + '</td><td>' + data[i].description + '</td><td>' + data[i].status + '</td><td>' + data[i].usrid + '</td><td>' + data[i].date + '</td><td><a href="#editEmployeeModal" class="edit" data-toggle="modal"><i class="bx bxs-edit-alt text-primary" class="material-icons " data-toggle="tooltip" title="Edit">&#xE254;</i></a><input type="hidden" value="{{val.crname}}" class="crnname">{% csrf_token %}<a href="#deleteEmployeeModal" data-item="{{val.crid}}" class="delete on_del" data-toggle="modal"  ><i class="bx bx-trash text-danger" data-toggle="tooltip" title="Delete"></i></a></td></tr>');
      }
  }
  
  function createPaginationButtons(totalPages, currentPage) {
      var paginationContainer = $('#pagination-container');
      paginationContainer.empty();
  
      // Previous button
      paginationContainer.append('<button class="page-item pagination-button" onclick="fetchPage(' + (currentPage - 1) + ')" ' + (currentPage > 1 ? '' :'onMouseOver="this.style.color=" disabled') + '>Previous</button>');

// Page buttons
for (var i = 1; i <= totalPages; i++) {
    paginationContainer.append('<button class="page-item pagination-button ' + (i === currentPage ? 'active-page' : '') + '" onclick="fetchPage(' + i + ')">'+ i + ' </button>');
}

// Next button
paginationContainer.append('<button class="page-item pagination-button" onclick="fetchPage(' + (currentPage + 1) + ')" ' + (currentPage < totalPages ? '' : 'style="color:gray;"disabled') + '>Next</button>');



    // Add event listener for the "Select All" checkbox
    $('#select-all').on('change', function() {
        $('.row-checkbox').prop('checked', this.checked);
       
    });
}
 
  // Initial data fetch
  fetchPage(1);
  
  // Add filter event using jQuery
  $('#filter-input').on('input', function() {
      fetchPage(1); // Fetch the first page when the filter changes
  });

  //get value

  $('.row-checkbox').on('click', function() {
    // Get the value of the clicked checkbox
    var checkboxValue = $(this).val();
    console.log('Clicked Checkbox Value:', checkboxValue);
});

// Handle the click event of "Select All" checkbox
$('#select-all').on('click', function() {
    // Get values of all checkboxes with class "row-checkbox"
    var allCheckboxValues = $('.row-checkbox').map(function() {
        return $(this).val();
    }).get();

    console.log('All Checkbox Values:', allCheckboxValues);
});


$('.row-checkbox').on('click', function() {
    // Check if the checkbox is checked
    if ($(this).prop('checked')) {
        // Get the value of the checked checkbox
        var checkboxValue = $(this).val();
        console.log('Checked Checkbox Value:', checkboxValue);
    }
});


  </script>
<!--end pagination-->

<!--select all-->

<!--end-->
  </body>
  </html>
  {% endblock content %}
    </section>


  
   



    
